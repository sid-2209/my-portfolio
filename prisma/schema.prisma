generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

model Content {
  id            String   @id @default(cuid())
  title         String
  description   String
  contentType   String
  posterImage   String?
  contentUrl    String?
  publishedDate DateTime @default(now())
  author        String   @default("Sid")
  tags          String[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  category      String?
  featured      Boolean  @default(false)
  imageUrl      String?
  
  // New CMS fields
  status        ContentStatus @default(DRAFT)
  contentBlocks ContentBlock[]
  slug          String?       @unique // URL-friendly version of title
  
  @@index([contentType])
  @@index([publishedDate])
  @@index([tags])
  @@index([featured])
  @@index([category])
  @@index([status])
  @@index([slug])
}

model ContentBlock {
  id        String   @id @default(cuid())
  contentId String
  content   Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  blockType BlockType
  order     Int
  data      Json     // Flexible data storage for block content
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([contentId, order])
  @@index([contentId])
  @@index([blockType])
}

enum BlockType {
  PARAGRAPH
  HEADING
  IMAGE
  CODE_BLOCK
  QUOTE
  LIST
  DIVIDER
  CUSTOM
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}
